{% load static %}
{% load block_tags %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å {{ website.title }} - Web Lego</title>
    <link rel="stylesheet" href="{% static 'base/css/edit_website.css' %}">
</head>
<body data-website-id="{% if website.id %}{{ website.id }}{% else %}null{% endif %}">
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <a href="{% url 'dashboard' %}" class="logo">Web Lego</a>
            <div class="nav-links">
                <button class="nav-link preview-btn" onclick="openPreview()">üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                <a href="{% url 'view_website' website.id %}" target="_blank" class="nav-link">üåê –û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç</a>
                <a href="{% url 'dashboard' %}" class="nav-link">‚Üê –ù–∞–∑–∞–¥</a>
            </div>
        </nav>
    </header>

    <!-- Editor Container -->
    <div class="editor-container">
        <!-- –ü–∞–Ω–µ–ª—å –±–ª–æ–∫–æ–≤ -->
        <div class="blocks-panel">
            <h3>üì¶ –ë–ª–æ–∫–∏</h3>
            <div class="block-types">
                <div class="block-type-btn" draggable="true" data-type="heading">
                    üìù –ó–∞–≥–æ–ª–æ–≤–æ–∫
                </div>
                <div class="block-type-btn" draggable="true" data-type="text">
                    üìÑ –¢–µ–∫—Å—Ç
                </div>
                <div class="block-type-btn" draggable="true" data-type="image">
                    üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                </div>
                <div class="block-type-btn" draggable="true" data-type="video">
                    üé• –í–∏–¥–µ–æ
                </div>
                <div class="block-type-btn" draggable="true" data-type="button">
                    üîò –ö–Ω–æ–ø–∫–∞
                </div>
                <div class="block-type-btn" draggable="true" data-type="slider">
                    üé† –°–ª–∞–π–¥–µ—Ä
                </div>
            </div>
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
        <div class="editor-area">
            <div class="editor-canvas" id="editor-canvas">
                {% if blocks %}
                    {% for block in blocks %}
                        <div class="block-item" data-block-id="{{ block.id }}" data-block-type="{{ block.block_type }}" draggable="true">
                            <div class="block-controls">
                                <button type="button" class="block-btn" onclick="editBlock('{{ block.id }}')">‚úèÔ∏è</button>
                                <button type="button" class="block-btn delete" onclick="deleteBlock('{{ block.id }}')">üóëÔ∏è</button>
                            </div>
                            {% if block.block_type == 'image' or block.block_type == 'slider' %}
                            <div class="block-resize-handle se" data-handle="se"></div>
                            <div class="block-resize-handle sw" data-handle="sw"></div>
                            <div class="block-resize-handle ne" data-handle="ne"></div>
                            <div class="block-resize-handle nw" data-handle="nw"></div>
                            <div class="block-resize-handle e" data-handle="e"></div>
                            <div class="block-resize-handle w" data-handle="w"></div>
                            <div class="block-resize-handle n" data-handle="n"></div>
                            <div class="block-resize-handle s" data-handle="s"></div>
                            {% endif %}
                            <div class="block-content">
                                {{ block|render_block }}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±–ª–æ–∫–∏ —Å—é–¥–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–µ–Ω–¥–∏–Ω–≥</p>
                    </div>
                {% endif %}
                <div class="drop-zone" id="drop-zone">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±–ª–æ–∫ —Å—é–¥–∞</div>
            </div>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div class="settings-panel">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <form id="settings-form" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞</label>
                    <input type="text" name="title" class="form-input" value="{{ website.title }}">
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç —Ñ–æ–Ω–∞</label>
                    <div class="color-input">
                        <input type="color" name="background_color" value="{{ website.background_color|default:'#ffffff' }}">
                        <input type="text" class="form-input" value="{{ website.background_color|default:'#ffffff' }}" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
                    <div class="color-input">
                        <input type="color" name="text_color" value="{{ website.text_color|default:'#000000' }}">
                        <input type="text" class="form-input" value="{{ website.text_color|default:'#000000' }}" readonly>
                    </div>
                </div>

                <h4 style="margin-top: 2rem; margin-bottom: 1rem; color: #7c3aed;">Header</h4>
                
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                    <input type="text" name="header_company_name" class="form-input" value="{{ website.header_company_name }}">
                </div>

                <div class="form-group">
                    <label class="form-label">–õ–æ–≥–æ—Ç–∏–ø</label>
                    <input type="file" name="header_logo" class="form-input" accept="image/*">
                    {% if website.header_logo %}
                        <img src="{{ website.header_logo.url }}" alt="Logo" style="max-width: 100px; margin-top: 0.5rem;">
                    {% endif %}
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ Header</label>
                    <div class="color-input">
                        <input type="color" name="header_background_color" value="{{ website.header_background_color|default:'#ffffff' }}">
                        <input type="text" class="form-input" value="{{ website.header_background_color|default:'#ffffff' }}" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ Header</label>
                    <div class="color-input">
                        <input type="color" name="header_text_color" value="{{ website.header_text_color|default:'#000000' }}">
                        <input type="text" class="form-input" value="{{ website.header_text_color|default:'#000000' }}" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="header_show" {% if website.header_show %}checked{% endif %}>
                        –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å Header
                    </label>
                </div>

                <h4 style="margin-top: 2rem; margin-bottom: 1rem; color: #7c3aed;">Footer</h4>

                <div class="form-group">
                    <label class="form-label">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ Footer</label>
                    <textarea name="footer_content" class="form-input" rows="3">{{ website.footer_content }}</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç —Ñ–æ–Ω–∞ Footer</label>
                    <div class="color-input">
                        <input type="color" name="footer_background_color" value="{{ website.footer_background_color|default:'#f3f4f6' }}">
                        <input type="text" class="form-input" value="{{ website.footer_background_color|default:'#f3f4f6' }}" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ Footer</label>
                    <div class="color-input">
                        <input type="color" name="footer_text_color" value="{{ website.footer_text_color|default:'#000000' }}">
                        <input type="text" class="form-input" value="{{ website.footer_text_color|default:'#000000' }}" readonly>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="footer_show" {% if website.footer_show %}checked{% endif %}>
                        –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å Footer
                    </label>
                </div>

                <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
    <div class="preview-modal" id="preview-modal">
        <div class="preview-content">
            <button class="preview-close" onclick="closePreview()">√ó</button>
            <iframe src="{% url 'view_website' website.id %}" style="width: 100%; height: 80vh; border: none;"></iframe>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–∞ -->
    <div class="edit-modal" id="edit-modal">
        <div class="edit-modal-content">
            <button class="edit-modal-close" onclick="closeEditModal()">√ó</button>
            <div id="edit-modal-body">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
    <script src="{% static 'base/js/edit_website.js' %}"></script>
</body>
</html>
